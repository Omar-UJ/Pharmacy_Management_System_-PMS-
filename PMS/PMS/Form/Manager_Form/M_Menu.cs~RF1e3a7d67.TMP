using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Data.SqlClient;
using System.Drawing;
using System.IO;
using System.Text;
using System.Windows.Forms;

namespace PMS
{
    public partial class M_Menu : Form
    {
        SqlConnection con = new SqlConnection("data source =DESKTOP-VV29LOD;database = PMS;integrated security = true");
        DataTable dataTable;
        String id = "", name = "",lName = "",phone = "";
        String city = "",address = "",dob = "",gender= "";
        String pharmacy_id = "";
      

        public M_Menu(DataTable dt,String selected)
        {
            
            InitializeComponent();
            this.dataTable = dt;
            foreach (DataRow row in dt.Rows)
            {
                 id = row["m_id"].ToString();
                 name = row["m_name"].ToString();
                 lName = row["m_lname"].ToString();
                 phone = row["m_phone"].ToString();
                 city = row["m_city"].ToString();
                 address = row["m_address"].ToString();
                 dob = row["m_dob"].ToString();
                 gender = row["m_gender"].ToString();
                 pharmacy_id =  row["p_id"].ToString();
                
            }
            pID_LB.Text = id;
            pName_LB.Text = name+" "+lName;
            MS_FNameTB.Text = name;
            MS_LNameTB.Text = lName;
            MS_CityCB.Text = city;
            MS_AddressTB.Text = address;
            MS_PNumberTB.Text = phone;
            MS_bDateLB.Text = dob;
            if (gender.ToUpper() == "M") MS_maleRB.Select();
            else MS_femaleRB.Select();

            if (selected == "search")
            {
                M_hide();
                M_searchItemTB.Visible = true;
                M_searchBtn.Location = new Point(783, 30);

                con.Open();
                SqlCommand cmd = new SqlCommand("SELECT *from ITEM", con);
                SqlDataAdapter sda = new SqlDataAdapter(cmd);
                DataTable sdt = new DataTable();
                sda.Fill(sdt);
                searchDGV.DataSource = dt;
                con.Close();
            }
            else if (selected == "report")
            {
                M_hide();
                reportPanel.Visible = true;
            }else if (selected == "items")
            {
                M_hide();
                itemsPanel.Visible = true;
            }else if (selected == "employee")
            {
                M_hide();
                employeePanel.Visible = true;
            }else if (selected == "setting")
            {
                M_hide();
                M_settingPanel.Visible = true;
            }
        }
        public void M_hide()
        {
            M_settingPanel.Visible = false;
            reportPanel.Visible = false;
            welcomeLB.Visible = false;
            M_welcomePb.Visible = false;
            M_notificationPanel.Visible = false;
            itemNempPanel.Visible = false;
            employeePanel.Visible = false;
            itemsPanel.Visible = false;
            searchItemsPanel.Visible = false;
            M_searchItemTB.Visible = false;
            M_searchBtn.Anchor = new AnchorStyles();
        }

        private void M_Menu_Load(object sender, EventArgs e)
        {
           

        }

        private void Panel2_Paint(object sender, PaintEventArgs e)
        {
            
        }

        private void ShowBtn_Click(object sender, EventArgs e)
        {
           
        }

        private void M_hideBtn_Click(object sender, EventArgs e)
        {
           
        }

        private void Button7_Click(object sender, EventArgs e)
        {
            Login login = new Login();
            DialogResult dialogResult = MessageBox.Show("Are you sure, you want to logout?", "Logout", MessageBoxButtons.YesNo);
            if (dialogResult == DialogResult.Yes)
            {
                File.WriteAllText("rmbr.pmsac", string.Empty); this.Hide();
                login.Show();
            }
        }

        private void Button4_Click(object sender, EventArgs e)
        {
            M_hide();
            welcomeLB.Visible = true;
            M_welcomePb.Visible = true;
            ManagerDashboard dash = new ManagerDashboard(this.dataTable);
            dash.Size = new Size(this.Size.Width, this.Size.Height);
            dash.Location = new Point(this.Location.X, this.Location.Y);
            dash.Show();
            this.Hide();

        }

        private void Button9_Click(object sender, EventArgs e)
        {
            M_hide();
            reportPanel.Visible = true;
        }

        private void ItemNemp_PanBtn_Click(object sender, EventArgs e)
        {
            M_hide();
            itemNempPanel.Visible = true;

        }

        private void Button19_Click(object sender, EventArgs e)
        {
            M_hide();
            employeePanel.Visible = true;
            con.Open();
            SqlCommand cmd = new SqlCommand("SELECT *from CASHIER", con);
            SqlDataAdapter sda = new SqlDataAdapter(cmd);
            DataTable dt = new DataTable();
            sda.Fill(dt);
            CashierDGV.DataSource = dt;
            

           
            dt = new DataTable();
            cmd = new SqlCommand("SELECT *from PHARMACIST", con);
            sda = new SqlDataAdapter(cmd);
            sda.Fill(dt);
            pharmacistDGV.DataSource = dt;
            con.Close();
             /*cmd = new SqlCommand("SELECT *from OTHERS", con);
            sda = new SqlDataAdapter(cmd);
            sda.Fill(dt);
            othersDGV.DataSource = dt;*/

        }

        private void Button22_Click(object sender, EventArgs e)
        {
            String query = "",gender="";
            if (eMaleRB.CanSelect) gender = "M";
            else gender = "F";
            if (eJobCB.Text.ToUpper()  == "PHARMACIST")
                query = "insert into PHARMACIST(ph_name, ph_lname, ph_phone, ph_dob, ph_city, ph_address, ph_gender,ph_password, p_id,ph_status) ";
            else if (eJobCB.Text.ToUpper() == "CASHIER")
                query = "insert into CASHIER(ca_name, ca_lname, ca_phone, ca_dob, ca_city, ca_address, ca_gender,ca_password, p_id,ca_status ) ";
            else if (eJobCB.Text.ToUpper() == "OTHERS")
                query = "insert into CASHIER(oe_name, oe_lname, oe_phone, oe_dob, oe_city, oe_address, oe_gender,oe_password, p_id,oe_status ) ";

            SqlCommand cmd = new SqlCommand(query + " values ('" + eFNameTB.Text + "','" + eLNameTB.Text + "','" + ePhoneTB.Text + "','"
                + eDobCB.Value.ToString() + "','" + eCityCB.Text + "','" + eAddressTB.Text + "','" + gender + "','" + ePasswordTB.Text
                + "','" + pharmacy_id + "' , 'Active');", con);
            con.Open();
            cmd.ExecuteNonQuery();
            con.Close();
        }

        private void AddItemBtn_Click(object sender, EventArgs e)
        {
            SqlCommand cmd = new SqlCommand("insert into ITEM(i_name, i_descr, i_price, i_sdate, i_expdate, i_import_date,i_qty, p_id,m_id) " 
                + " values ('" + aINameTB.Text + "','" + aIDescTB.Text + "','" + aIPriceTB.Text+ "','"
                +aISdateCB.Value.ToString() + "','" + aIExpDateCB.Value.ToString() + "',GETDATE(),'" + aIQtyTB.Text + "','" + pharmacy_id
                + "','" + id +"');", con);
            con.Open();
            cmd.ExecuteNonQuery();
            con.Close();
        }

        private void Button18_Click(object sender, EventArgs e)
        {
             M_hide();
            itemsPanel.Visible = true;
        }

        private void UserIdTB_TextChanged(object sender, EventArgs e)
        {
            searchItemsPanel.Visible = true;
            string search;
            search = M_searchItemTB.Text.Trim();
            try
            {
                con.Open();
                //string queery = ;
                SqlCommand cmd = new SqlCommand("SELECT *from VIEW_ITEMS WHERE i_id like '%" + search + "%'", con);
                //cmd.CommandType = CommandType.StoredProcedure;
                //cmd.Parameters.AddWithValue("@keyword", search);
                SqlDataAdapter sda = new SqlDataAdapter(cmd);
                DataTable dt = new DataTable();
                sda.Fill(dt);
                searchDGV.DataSource = dt;
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
            finally
            {
                con.Close();
            }
        }

        private void Button5_Click(object sender, EventArgs e)
        {
            M_hide();
            M_searchItemTB.Visible = true;
            M_searchBtn.Location = new Point(783, 30);
        }

        private void TextBox21_TextChanged(object sender, EventArgs e)
        {
            string search;
            search = serachItemsInUpdateTb.Text.Trim();
            try
            {
                con.Open();
                SqlCommand cmd = new SqlCommand("SELECT *from ITEM WHERE i_id like '%" + search + "%'", con);
                SqlDataAdapter sda = new SqlDataAdapter(cmd);
                DataTable dt = new DataTable();
                sda.Fill(dt);
                DGVinUpdateItems.DataSource = dt;
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
            finally
            {
                con.Close();
            }
        }

        private void SerachItemsInUpdateTb_TextChanged(object sender, EventArgs e)
        {
            string search;
            search = serachItemsInUpdateTb.Text.Trim();
            try
            {
                con.Open();
                SqlCommand cmd = new SqlCommand("SELECT *from ITEM WHERE i_id like '%" + search + "%'", con);
                SqlDataAdapter sda = new SqlDataAdapter(cmd);
                DataTable dt = new DataTable();
                sda.Fill(dt);
                DGVinUpdateItems.DataSource = dt;
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
            finally
            {
                con.Close();
            }
        }

        private void DGVinUpdateItems_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            if (DGVinUpdateItems.SelectedRows.Count>0)
            {
                DataGridViewRow row = this.DGVinUpdateItems.Rows[e.RowIndex];
                aIdLB.Text = row.Cells[0].Value.ToString();
                aINameTB.Text = row.Cells[1].Value.ToString();
                aIDescTB.Text = row.Cells[2].Value.ToString();
                aIPriceTB.Text = row.Cells[3].Value.ToString();
                aISdateCB.Text = row.Cells[4].Value.ToString();
                aIExpDateCB.Text = row.Cells[6].Value.ToString();
                aIQtyTB.Text = row.Cells[7].Value.ToString();
                return;
            }      
        }

        private void UpdateItemsBtn_Click(object sender, EventArgs e)
        {
            SqlCommand cmd = new SqlCommand("update  ITEM SET " +
                "i_name = '" + aINameTB.Text+ "'," +
                "i_descr = '" + aIDescTB.Text + "'," +
                "i_qty = '" + aIQtyTB.Text + "'," +
                "i_price = '" + aIPriceTB.Text + "'," +
                "i_sdate = '" + aISdateCB.Value.ToString() + "'," +
                "i_expdate = '" + aIExpDateCB.Value.ToString() + "' WHERE i_id = '" + aIdLB.Text + "'", con);
            con.Open();
            cmd.ExecuteNonQuery();
            con.Close();
        }

        private void TabControl4_MouseClick(object sender, MouseEventArgs e)
        {
            con.Open();
            String date = DateTime.UtcNow.ToString();
            SqlCommand cmd = new SqlCommand("EXP_ITEMS '"+date+"',"+pharmacy_id+" ", con);
            SqlDataAdapter sda = new SqlDataAdapter(cmd);
            DataTable dt = new DataTable();
            sda.Fill(dt);
            expItemDGV.DataSource = dt;
            con.Close();
        }

        private void ExpItemDGV_CellClick(object sender, DataGridViewCellEventArgs e)
        {
            if (DGVinUpdateItems.SelectedRows.Count > 0)
            {
                DataGridViewRow row = this.DGVinUpdateItems.Rows[e.RowIndex];
                expItemidTB.Text = row.Cells[0].Value.ToString();
                return;
            }
        }

        private void RemoveExpItemBtn_Click(object sender, EventArgs e)
        {
            SqlCommand cmd = new SqlCommand("Delete From ITEM WHERE i_id = '" + expItemidTB.Text + "'", con);
            con.Open();
            cmd.ExecuteNonQuery();
            con.Close();
        }

        private void ExpItemsListTab_Click(object sender, EventArgs e)
        {
            con.Open();
            SqlCommand cmd = new SqlCommand("SELECT *from ITEM", con);
            SqlDataAdapter sda = new SqlDataAdapter(cmd);
            DataTable dt = new DataTable();
            sda.Fill(dt);
            expItemsListDGV.DataSource = dt;
            con.Close();
        }

        private void ExpItemsListTab_Click_1(object sender, EventArgs e)
        {
            con.Open();
            SqlCommand cmd = new SqlCommand("SELECT *from ITEM", con);
            SqlDataAdapter sda = new SqlDataAdapter(cmd);
            DataTable dt = new DataTable();
            sda.Fill(dt);
            DGVinUpdateItems.DataSource = dt;
            con.Close();
        }

        private void ExpItemsListTab_Selected(object sender, TabControlEventArgs e)
        {
            con.Open();
            SqlCommand cmd = new SqlCommand("SELECT *from EXP_ITEM", con);
            SqlDataAdapter sda = new SqlDataAdapter(cmd);
            DataTable dt = new DataTable();
            sda.Fill(dt);
            expItemsListDGV.DataSource = dt;
            con.Close();
        }

        private void M_MenuListPanel_MouseCaptureChanged(object sender, EventArgs e)
        {
            M_MenuListPanel.BringToFront();
        }

        private void M_MenuListPanel_MouseHover(object sender, EventArgs e)
        {
            M_MenuListPanel.BringToFront();
        }

        private void M_MenuListPanel_MouseLeave(object sender, EventArgs e)
        {
            M_MenuBGPanel.BringToFront();
           
        }

        private void Button4_MouseHover(object sender, EventArgs e)
        {
            M_MenuListPanel.BringToFront();
        }

        private void ItemNemp_PanBtn_MouseHover(object sender, EventArgs e)
        {
            M_MenuListPanel.BringToFront();
        }

        private void Button8_MouseHover(object sender, EventArgs e)
        {
            M_MenuListPanel.BringToFront();
        }

        private void Button9_MouseHover(object sender, EventArgs e)
        {
            M_MenuListPanel.BringToFront();
        }

        private void Button1_MouseHover(object sender, EventArgs e)
        {
            M_MenuListPanel.BringToFront();
        }

        private void Button4_MouseLeave(object sender, EventArgs e)
        {
            M_MenuBGPanel.BringToFront();
         
        }

        private void ItemNemp_PanBtn_MouseLeave(object sender, EventArgs e)
        {
            M_MenuBGPanel.BringToFront();
          
        }

        private void Button8_MouseLeave(object sender, EventArgs e)
        {
            M_MenuBGPanel.BringToFront();
            
        }

        private void Button9_MouseLeave(object sender, EventArgs e)
        {
            M_MenuBGPanel.BringToFront();
           
        }

        private void Button1_MouseLeave(object sender, EventArgs e)
        {
            M_MenuBGPanel.BringToFront();
          
        }

        private void LightModeRB_CheckedChanged(object sender, EventArgs e)
        {
            M_MenuListPanel.BackColor = Color.MediumSeaGreen;
            M_headerPanel.BackColor = Color.White;
        }

        private void DarkModeRB_CheckedChanged(object sender, EventArgs e)
        {
            
            M_MenuListPanel.BackColor = Color.DarkSlateGray;
            M_headerPanel.BackColor = Color.DarkSlateGray;
        }

        private void M_MenuBGPanel_Paint(object sender, PaintEventArgs e)
        {
            M_MenuBGPanel.BringToFront();
         
        }

        private void M_MenuListPanel_Paint(object sender, PaintEventArgs e)
        {

        }

        private void Button1_Click(object sender, EventArgs e)
        {
            M_hide();
            M_settingPanel.Visible = true;
        }

        private void Button8_Click(object sender, EventArgs e)
        {
            M_hide();
            M_notificationPanel.Visible = true;
        }

        private void Button3_Click(object sender, EventArgs e)
        {

        }

        private void RegisterBtn_Click(object sender, EventArgs e)
        {
            SqlCommand cmd = new SqlCommand("update  MANAGER SET " +
                "m_name = '"+MS_FNameTB.Text+"'," +
                "m_lname = '" + MS_LNameTB.Text + "'," +
                "m_phone = '" +MS_PNumberTB.Text + "'," +
                "m_dob = '" + MS_bDateLB.Text + "'," +
                "m_city = '" + MS_CityCB.Text + "'," +
                "m_address = '" + MS_AddressTB.Text + "' WHERE m_id = '"+this.id+"'",con);
            con.Open();
            cmd.ExecuteNonQuery();
            con.Close();
        }
    }
}
